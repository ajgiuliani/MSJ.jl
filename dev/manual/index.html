<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Manual · msJ.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link href="../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><a href="../index.html"><img class="logo" src="../assets/logo.png" alt="msJ.jl logo"/></a><h1>msJ.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../">Home</a></li><li class="current"><a class="toctext" href>Manual</a><ul class="internal"><li><a class="toctext" href="#Introduction-1">Introduction</a></li><li><a class="toctext" href="#Public-elements-1">Public elements</a></li><li><a class="toctext" href="#Data-types-1">Data types</a></li><li><a class="toctext" href="#Information-1">Information</a></li><li><a class="toctext" href="#Importing-data-1">Importing data</a></li><li><a class="toctext" href="#Exporting-data-1">Exporting data</a></li><li><a class="toctext" href="#Combining-and-filtering-data-1">Combining and filtering data</a></li><li><a class="toctext" href="#Processing-1">Processing</a></li><li><a class="toctext" href="#Plotting-1">Plotting</a></li></ul></li><li><a class="toctext" href="../tutorial/">Tutorial</a></li><li><a class="toctext" href="../reference/">Reference</a></li><li><a class="toctext" href="../misc/">Miscellaneous</a></li></ul></nav><article id="docs"><header><nav><ul><li><a href>Manual</a></li></ul><a class="edit-page" href="https://github.com/ajgiuliani/msJ.jl/blob/master/docs/src/manual.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Manual</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="Manual-1" href="#Manual-1">Manual</a></h1><h2><a class="nav-anchor" id="Introduction-1" href="#Introduction-1">Introduction</a></h2><hr/><p>The <code>msJ</code> package aims at providing an API to the most common file format in mass spectrometry. The following file formats are currently supported:</p><ul><li>mzXML </li></ul><h2><a class="nav-anchor" id="Public-elements-1" href="#Public-elements-1">Public elements</a></h2><hr/><p>The functions below are exported:</p><ul><li><a href="../reference/#msJ.info-Tuple{String}"><code>info</code></a> </li><li><a href="../reference/#msJ.load-Tuple{String}"><code>load</code></a> </li><li><a href="../reference/#msJ.chromatogram-Tuple{String,Vararg{msJ.FilterType,N} where N}"><code>chromatogram</code></a></li><li><a href="../reference/#msJ.msfilter-Tuple{String,Vararg{msJ.FilterType,N} where N}"><code>msfilter</code></a></li><li><a href="../reference/#msJ.centroid-Tuple{msJ.MScontainer}"><code>centroid</code></a></li><li><a href="../reference/#msJ.smooth-Tuple{msJ.MScontainer}"><code>smooth</code></a></li></ul><h2><a class="nav-anchor" id="Data-types-1" href="#Data-types-1">Data types</a></h2><hr/><p>The main data type of the package is the abstract type <a href="../reference/#msJ.MScontainer"><code>msJ.MScontainer</code></a>.</p><p>Mass spectrometry scans are stored in the following structures, inspired from the mzXML format, which is a subtype of <a href="../reference/#msJ.MScontainer"><code>msJ.MScontainer</code></a>. </p><pre><code class="language-julia">struct MSscan &lt;: MScontainer
    num::Int                          # num
    rt::Float64                       # retentionTime
    tic::Float64                      # totIonCurrent
    mz::Vector{Float64}               # m/z
    int::Vector{Float64}              # intensity
    level::Int                        # msLevel
    basePeakMz::Float64               # basePeakMz
    basePeakIntensity::Float64        # basePeakIntensity
    precursor::Float64                # precursorMz
    polarity::String                  # polarity
    activationMethod::String          # activationMethod
    collisionEnergy::Float64          # collisionEnergy
end</code></pre><p>Another subtype, <a href="../reference/#msJ.Chromatogram"><code>msJ.Chromatogram</code></a>, is used to store the retention time, the ionic current and the maximum value of the ion current.</p><pre><code class="language-julia">struct Chromatogram  &lt;: MScontainer
    rt::Vector{Float64}               # araay of retention times
    ic::Vector{Float64}               # array of ion current
    maxic::Float64                    # maximum ion current (used in plotting normalization)
end</code></pre><p>Combination of mass spectra requires another subtype of <a href="../reference/#msJ.MScontainer"><code>msJ.MScontainer</code></a> called <a href="../reference/#msJ.MSscans"><code>msJ.MSscans</code></a> (notice the ending s).</p><pre><code class="language-julia">struct MSscans  &lt;: MScontainer
    num::Vector{Int}                  # num
    rt::Vector{Float64}               # retentionTime
    tic::Float64                      # totIonCurrent
    mz::Vector{Float64}               # m/z
    int::Vector{Float64}              # intensity
    level::Vector{Int}                # msLevel
    basePeakMz::Float64               # basePeakMz
    basePeakIntensity::Float64        # basePeakIntensity
    precursor::Vector{Float64}        # precursorMz
    polarity::Vector{String}          # polarity
    activationMethod::Vector{String}  # activationMethod
    collisionEnergy::Vector{Float64}  # collisionEnergy
    s::Vector{Float64}                # variance
end</code></pre><p>The <a href="../reference/#msJ.MSscans"><code>msJ.MSscans</code></a> structure is very similar to the <a href="../reference/#msJ.MSscan"><code>msJ.MSscan</code></a> one, except that the fields <code>num</code>, <code>rt</code>, <code>precursor</code>, <code>polarity</code>, <code>activationMethod</code> and <code>collisionEnergy</code> are vectors. The idea is to keep track of the <em>history</em> of the operations that have led to this result. For example, if a <code>MSscans</code> element is the result of the addition of two individual scans such as scans[1] + scans[2], then the <code>num</code>field of resulting <code>MSscans</code> is an array [1, 2]. The same applies to the retention time, precursor m/z, polarity, activation method and collision energy fields.</p><h2><a class="nav-anchor" id="Information-1" href="#Information-1">Information</a></h2><hr/><p>The <a href="../reference/#msJ.info-Tuple{String}"><code>info</code></a> public function reads the content of a file, but without loading the mass spectrometry data, and returns a <code>Vector{String}</code>containing the number of scans, scans level and for MS/MS data, the precursor m/z, the activation method and energy. Additional information may be gained by setting <code>verbose = true</code>.</p><pre><code class="language-julia-repl">msJ.info(filename)
4-element Array{String,1}:
 &quot;51 scans&quot;
 &quot;MS1+&quot;
 &quot;MS2+ 1255.5  CID(CE=18)&quot;
 &quot;MS3+ 902.33  PQD(CE=35)&quot;</code></pre><h2><a class="nav-anchor" id="Importing-data-1" href="#Importing-data-1">Importing data</a></h2><hr/><p>When loading a file containing more than a single acquisition, the individual mass spectrometry scans are pushed into an array of <a href="../reference/#msJ.MSscan"><code>msJ.MSscan</code></a>.  The individual scans may be retrieve from the array the usual way:</p><pre><code class="language-julia-repl">julia&gt; scans = load(&quot;filename&quot;)
51-element Array{msJ.MSscan,1}:
 msJ.MSscan(1, 0.1384, 5.08195e6, [140.083, 140.167, 140.25, 140.333, 140.417, 140.5, 140.583, 140.667, 140.75, 140.833  …  1999.25, 1999.33, 1999.42, ....)
...

julia&gt; scans[1]
msJ.MSscan(1, 0.1384, 5.08195e6, [140.083, 140.167, 140.25, 140.333, 140.417, 140.5, 140.583, 140.667, 140.75, 140.833  …  1999.25, 1999.33, 1999.42, ....)</code></pre><p>As mentioned above, chromatograms may be retrieved from a file and imported in <a href="../reference/#msJ.Chromatogram"><code>msJ.Chromatogram</code></a> :</p><pre><code class="language-julia-repl">julia&gt; chromatogram(&quot;filename&quot;)
msJ.Chromatogram([0.1384, 0.7307, 2.1379, 3.7578, 4.3442, 5.7689], [5.08195e6, 9727.2, 11.3032, 4.8084e6, 12203.5, 4.84455], 5.08195e6)</code></pre><p>The function <a href="../reference/#msJ.retention_time-Tuple{String}"><code>msJ.retention_time</code></a> reads the retention time of an input file and returns a <code>Vector{Float64}</code>containing the time in seconds.</p><pre><code class="language-julia-repl">julia&gt; msJ.retention_time(&quot;filename&quot;)
51-element Array{Float64,1}:
  0.1384
  0.7307
  2.1379
....msJ.FilterType
</code></pre><h2><a class="nav-anchor" id="Exporting-data-1" href="#Exporting-data-1">Exporting data</a></h2><hr/><div class="admonition note"><div class="admonition-title">Note</div><div class="admonition-text"><p>This feature is currently under development. </p></div></div><h2><a class="nav-anchor" id="Combining-and-filtering-data-1" href="#Combining-and-filtering-data-1">Combining and filtering data</a></h2><hr/><h3><a class="nav-anchor" id="Average-1" href="#Average-1">Average</a></h3><hr/><p>The <a href="../reference/#msJ.msfilter-Tuple{String,Vararg{msJ.FilterType,N} where N}"><code>msfilter</code></a> returns the average of the mass spectra directly from a <code>Vector{MSscan}</code> after <a href="#Importing-data-1">Importing data</a> data or directly from the <code>filename</code>.</p><pre><code class="language-julia-repl">julia&gt; msfilter(&quot;filename&quot;)
msJ.MSscans([1, 2, 3 ....

julia&gt; scans = load(&quot;filename&quot;)
51-element Array{msJ.MSscan,1}:
 msJ.MSscan(1, 0.1384, 5.08195e6, [140.083, 140.167, 140.25, 140.333, 140.417, 140.5, 140.583, 140.667, 140.75, 140.833  …  1999.25, 1999.33, 1999.42, ....)
...

julia&gt; msfilter(scans)
msJ.MSscans([1, 2, 3 ....
</code></pre><p>Operating on files takes more time than working on <code>Vector{MSscan}</code> but may be useful to reduce the memory load.</p><p>Without any argument the <a href="../reference/#msJ.msfilter-Tuple{String,Vararg{msJ.FilterType,N} where N}"><code>msfilter</code></a> function averages the entire content of the data and the <a href="../reference/#msJ.chromatogram-Tuple{String,Vararg{msJ.FilterType,N} where N}"><code>chromatogram</code></a> function operates on also on the entire data.</p><h3><a class="nav-anchor" id="Filtering-1" href="#Filtering-1">Filtering</a></h3><hr/><p>The <a href="../reference/#msJ.msfilter-Tuple{String,Vararg{msJ.FilterType,N} where N}"><code>msfilter</code></a> and <a href="../reference/#msJ.chromatogram-Tuple{String,Vararg{msJ.FilterType,N} where N}"><code>chromatogram</code></a> functions may takes arguments to select specific fields of interest within the data and operate on them. The argument belongs to the <a href="../reference/#msJ.FilterType"><code>msJ.FilterType</code></a>. Their properties are listed below:</p><table><tr><th style="text-align: right">FilterType</th><th style="text-align: right">Description</th><th style="text-align: right">Arguments</th><th style="text-align: right">Specificity</th></tr><tr><td style="text-align: right">msJ.Scan</td><td style="text-align: right">Scan num</td><td style="text-align: right">Int, Vector{Int}</td><td style="text-align: right">msfilter, chromatogram</td></tr><tr><td style="text-align: right">msJ.Level</td><td style="text-align: right">MS level</td><td style="text-align: right">Int, Vector{Int}</td><td style="text-align: right">msfilter, chromatogram</td></tr><tr><td style="text-align: right">msJ.Polarity</td><td style="text-align: right">Polarity</td><td style="text-align: right">String, Vector{String}</td><td style="text-align: right">msfilter, chromatogram</td></tr><tr><td style="text-align: right">msJ.Activation_Method</td><td style="text-align: right">Activation method</td><td style="text-align: right">String, Vector{String}</td><td style="text-align: right">msfilter, chromatogram</td></tr><tr><td style="text-align: right">msJ.Activation_Energy</td><td style="text-align: right">Activation energy</td><td style="text-align: right">Real, Vector{Real}</td><td style="text-align: right">msfilter, chromatogram</td></tr><tr><td style="text-align: right">msJ.Precursor</td><td style="text-align: right">Precursor m/z</td><td style="text-align: right">Real, Vector{Real}</td><td style="text-align: right">msfilter, chromatogram</td></tr><tr><td style="text-align: right">msJ.RT</td><td style="text-align: right">Retention time</td><td style="text-align: right">Real, Vector{Real}, Vector{Vector{Real}}</td><td style="text-align: right">msfilter</td></tr><tr><td style="text-align: right">msJ.IC</td><td style="text-align: right">Ion current</td><td style="text-align: right">Vector{Real}</td><td style="text-align: right">msfilter</td></tr></table><p>When the argument is restricted to a single value, such as <code>msJ.Scan(1)</code>, filtering is performed on that specific value. If the argument is a vector then filtering involves all the values within the range.  Filtering on <code>msJ.scan([1,10])</code> means that the result will be obtained for scans ranging from 1 to 10.  The same applies for all <code>FilterType</code>with the exception of <code>msJ.∆MZ</code>, for which the first value of the vector represents the <em>mz</em> and the second value represents the spread ∆mz, so that filtering is operated for all <em>mz</em> value in the range [m/z - ∆mz , m/z + ∆mz].  The <code>msJ.RT</code>type may take a vector or vectors as argument, such `msJ.RT([ [1,10], [20, 30] ]).  In that case, mass spectra will be averaged in [1,10] and [20,30] range.</p><p>These filters may be combined together if necessary. For example, the input below returns the average mass spectrum for:</p><ul><li>the MS2 scans (level = 2), </li><li>precursor m/z 1255.5, </li><li>upon CID activation conditions</li><li>with an activation energy of 18 </li><li>and for retention times in the 1 to 60 s range.</li></ul><pre><code class="language-julia">msfilter(&quot;filename&quot;, msJ.Precursor(1255.5),
                     msJ.Activation_Energy(18),
	   	             msJ.Activation_Method(&quot;CID&quot;),
		             msJ.Level(2),
		             msJ.RT( [1, 60] ),
					 )</code></pre><p>Several filter types may also be combined for <code>chromatograms</code>:</p><pre><code class="language-julia">chromatogram(&quot;filename&quot;, msJ.Precursor(1255.5),
                         msJ.Activation_Energy(18),
	   	                 msJ.Activation_Method(&quot;CID&quot;),
		                 msJ.Level(2),
						 )</code></pre><p>If the condition does not match any existing data, then an <code>ErrorException</code> is returned with the <code>&quot;No matching spectra.&quot;</code> message.</p><p>The <code>chromatogram</code> function has some methods using <code>msJ.MethodType</code> arguments:</p><table><tr><th style="text-align: right">MethodType</th><th style="text-align: right">Description</th><th style="text-align: right">Arguments</th><th style="text-align: right">Remark</th></tr><tr><td style="text-align: right">msJ.TIC</td><td style="text-align: right">Total ion current</td><td style="text-align: right">None</td><td style="text-align: right">Default</td></tr><tr><td style="text-align: right">msJ.BasePeak</td><td style="text-align: right">Base peak intensity</td><td style="text-align: right">None</td><td style="text-align: right"></td></tr><tr><td style="text-align: right">msJ.MZ</td><td style="text-align: right"><em>m/z</em> range</td><td style="text-align: right">Vector{Real}</td><td style="text-align: right"></td></tr><tr><td style="text-align: right">msJ.∆MZ</td><td style="text-align: right"><em>m/z</em> ± ∆mz</td><td style="text-align: right">Vector{Real}</td><td style="text-align: right"></td></tr></table><p>These types control the way chromatograms are calculated: either using the total ionic current, the base peak intensity or using a <em>m/z</em> range.  The <code>method</code> argument of the <code>msJ.chromatogram</code>function is set to msJ.TIC() by default. This setting may be overruled by setting the method to desired value:</p><pre><code class="language-julia">chromatogram(&quot;filename&quot;, method = msJ.BasePeak())
chromatogram(&quot;filename&quot;, method = msJ.MZ( [257, 259] ) ) 
chromatogram(&quot;filename&quot;, method = msJ.∆MZ( [258, 1] ) ) </code></pre><h2><a class="nav-anchor" id="Processing-1" href="#Processing-1">Processing</a></h2><hr/><h3><a class="nav-anchor" id="Smooth-1" href="#Smooth-1">Smooth</a></h3><hr/><p>The <a href="../reference/#msJ.smooth-Tuple{msJ.MScontainer}"><code>smooth</code></a> function is public and applies on <code>MSscan</code>or <code>MSscans</code> objects, with an optional <code>method</code> argument set to <code>msJ.SG(5, 9, 0)</code>.  Smoothing is performed on the <code>int</code> field using the <a href="https://en.wikipedia.org/wiki/Savitzky%E2%80%93Golay_filter">Savinsky and Golay</a>. The first argument is the order (5 by default), the second is the number of points (default 9)  and the last, is the derivative level (0). The function returns an <code>MScontainer</code> type identical to the input. </p><p>Other smoothing algorithms will be implemented in the future.</p><h3><a class="nav-anchor" id="Peak-picking-1" href="#Peak-picking-1">Peak picking</a></h3><hr/><p>Pick-picking is performed using the public <a href="../reference/#msJ.centroid-Tuple{msJ.MScontainer}"><code>centroid</code></a> function. It operates on <code>MSscan</code>or <code>MSscans</code>type of data and return a similar type. It takes a method argument, set by default to the Template Base Peak Detection method: <code>msJ.TBPD</code>. The TBPD method identifies features based on their similarity (as described by the Pearson correlation coefficient) with a <a href="https://doi.org/10.1007/978-1-60761-987-1_22">template peak</a>. By default the <code>msJ.TBPD</code> method type uses a Gaussian function, with 4500 mass resolving power and a threshold level set to 0.2% as :</p><pre><code class="language-julia">centroid(scan, method = TBPD(:gauss, 4500., 0.2)</code></pre><p>Addition peak detection algorithm ill be added in the future.</p><h2><a class="nav-anchor" id="Plotting-1" href="#Plotting-1">Plotting</a></h2><hr/><p>Plotting facilities are available as a submodule to the <code>msJ</code> package.  The <a href="../reference/#msJ.plots"><code>msJ.plots</code></a> module relies on the <a href="https://github.com/JuliaPlots/RecipesBase.jl">RecipesBase package</a>, which allows writing recipes to plot users&#39; data types. Hence, recipes have been created for <code>MSscan</code>, <code>Msscans</code> and <code>Chromatogram</code>:</p><pre><code class="language-julia-repl">julia&gt; plot(scans[1], method = :relative))
</code></pre><p>By default plotting is made in relative intensities, which may be changed by setting method to <code>:absolute</code>.</p><footer><hr/><a class="previous" href="../"><span class="direction">Previous</span><span class="title">Home</span></a><a class="next" href="../tutorial/"><span class="direction">Next</span><span class="title">Tutorial</span></a></footer></article></body></html>
